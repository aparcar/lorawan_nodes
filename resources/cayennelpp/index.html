
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://aparcar.github.io/lorawan_nodes/resources/cayennelpp/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.8">
    
    
      
        <title>CayenneLPP - LoRa sensor evaluation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.92558b1b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cayennelpp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LoRa sensor evaluation" class="md-header__button md-logo" aria-label="LoRa sensor evaluation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LoRa sensor evaluation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CayenneLPP
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/aparcar/lorawan_nodes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Start
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hardware/" class="md-tabs__link">
        Hardware
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Resources
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../software/" class="md-tabs__link">
        Software
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LoRa sensor evaluation" class="md-nav__button md-logo" aria-label="LoRa sensor evaluation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LoRa sensor evaluation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aparcar/lorawan_nodes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Hardware
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Hardware" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/gateways/" class="md-nav__link">
        Gateways
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/microcontroller/" class="md-nav__link">
        Microcontroller
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/pcb/" class="md-nav__link">
        Printed Circuit Board
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Resources
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          CayenneLPP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        CayenneLPP
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoding-using-raw-bits" class="md-nav__link">
    Encoding using raw Bits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-using-json" class="md-nav__link">
    Encoding using JSON
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-using-cayennelpp" class="md-nav__link">
    Encoding using CayenneLPP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-in-backend" class="md-nav__link">
    Decoding in Backend
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#used-payload-types" class="md-nav__link">
    Used payload types
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../datasheets/" class="md-nav__link">
        Datasheets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sensors/" class="md-nav__link">
        Sensors
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Software
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/grafana/" class="md-nav__link">
        Grafana Dashboard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/influxdb/" class="md-nav__link">
        InfluxDB Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/platformio/" class="md-nav__link">
        Platformio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/thethingsnetwork/" class="md-nav__link">
        LoRaWAN
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" >
      
      <label class="md-nav__link" for="__nav_4_6">
        Node
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Node" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Node
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/node/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/node/MB7389.cpp/" class="md-nav__link">
        MB7389.cpp
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/node/VH400.cpp/" class="md-nav__link">
        VH400.cpp
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/node/config.h/" class="md-nav__link">
        config.h
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../software/node/main.cpp/" class="md-nav__link">
        main.cpp
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoding-using-raw-bits" class="md-nav__link">
    Encoding using raw Bits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-using-json" class="md-nav__link">
    Encoding using JSON
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-using-cayennelpp" class="md-nav__link">
    Encoding using CayenneLPP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-in-backend" class="md-nav__link">
    Decoding in Backend
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#used-payload-types" class="md-nav__link">
    Used payload types
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aparcar/lorawan_nodes/edit/main/docs/resources/cayennelpp.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="cayennelpp">CayenneLPP</h1>
<p>This section explain CayenneLPP (Low Power Protocol) which is used to encode
data on sensor nodes into a size efficient format and decode it in the backend
back for further processing.</p>
<p><em>Cayenne</em> is a platform developed by <em>myDevices Inc.</em> offering custom dashboards
for device monitoring, alerts and more<sup id="fnref:mydevices"><a class="footnote-ref" href="#fn:mydevices">1</a></sup>. They developed
CayenneLPP<sup id="fnref:llp"><a class="footnote-ref" href="#fn:llp">2</a></sup> and multiple open source implementation of that protocol
exists<sup id="fnref:cats"><a class="footnote-ref" href="#fn:cats">3</a></sup><sup id="fnref:py"><a class="footnote-ref" href="#fn:py">5</a></sup>. The protocol allows a compromise between self describing
data packets and size efficiency, which will be explained in the next section.</p>
<p>This sections below show three ways to encode node data to a binary format for
sending over LoRa, a custom <em>raw</em> format, <em>JSON</em> and CayenneLPP. The example
data is a <strong>temperature</strong> value of 18.6 degree Celsius, a <strong>battery voltage</strong> of
3.9V and a <strong>distance</strong> value of 43mm.</p>
<h2 id="encoding-using-raw-bits">Encoding using raw Bits</h2>
<p>The smaller a LoRaWAN packet is the less power is required to send it and the
more airtime is available for other sensors. A simple solution would be just
store all sensor data as binary fields one after another. The packet could have
the following format:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&lt;temperature&gt;&lt;voltage&gt;&lt;distance&gt;
</code></pre></div>
</td></tr></table>
<p>Representing floats in binary isn't trivial to instead a prevision can be
defined. For <strong>temperature</strong> two float digits are enough, for <strong>battery
voltage</strong> a single float digit is fine and <strong>dinstance</strong> is always a integer.</p>
<p>This means values can be multiple by <code>100</code> respectively <code>10</code>. The temperature value
becomes <code>1860</code> and the voltage becomes <code>39</code>. Both considering that measured
temperature will never be above 99.99 degree Celsius and batter voltage should
exceed 9.9V (4.2V really). For distance a maximum of 5000mm should be used.</p>
<p>To calculate the maximum bits needed data, the maximum values are converted to
binary format the bit counted, easily possible with some Python:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="c1"># max value</span>
<span class="s1">&#39;10011100001111&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">))</span>
<span class="mi">14</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="c1"># max value</span>
<span class="s1">&#39;1100011&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">))</span>
<span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="c1"># max value</span>
<span class="s1">&#39;1001110001000&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">))</span>
<span class="mi">13</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div>
</td></tr></table>
<p>Above calculation shows that <strong>14</strong> Bits are needed for temperature, <strong>7</strong> for
battery voltage and <strong>13</strong> for distance. Now the custom data format becomes more
specific as shown below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>| temperature 14 | volt 7  | distance 13   |
| xxxxxxxxxxxxxx | xxxxxxx | xxxxxxxxxxxxx |
</code></pre></div>
</td></tr></table>
<p>Below we calculate the specific values and pad them with zeros.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">1860</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="s1">&#39;11101000100&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="s1">&#39;100111&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="s1">&#39;101011&#39;</span>
</code></pre></div>
</td></tr></table>
<p>The resulting packet would look like this with a total size of <strong>34 Bits</strong>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>| temperature 14 | volt 7  | distance 13   |
| 00011101000100 | 0101011 | 0000000101011 |
</code></pre></div>
</td></tr></table>
<p>The receiving backend could decode this data by reading the first 14 Bits as
integer and dividing the value by 100 to calculate the temperature, followed by
reading Bit 15 until 21 as integer and dividing it by 10 to calculate the
battery voltage. The remaining 13 Bit can be directly read as distance.</p>
<p>While this approach works and data is efficiently exchanged between sensor node
and backend, the calculation is not trivial to understand. More problematic is
the extendability of this approach: Newly added sensors may use a different
set of sensors and therefore require data fields. As the exchanged data is just
Bits, it's not possible to know what the data contains. In other words, the
format is extremely static and ideally the data would be more self explaining so
a backend would know what value it is decoding.</p>
<h2 id="encoding-using-json">Encoding using JSON</h2>
<p>The JSON format is extremely popular in web application to exchange all kinds of
data. It is human readable, supports all our data types directly (float and
integer) and allows to verbosely describe data fields. The example data could be
decoded as below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;temperature_1&quot;</span><span class="p">:</span> <span class="mf">18.6</span><span class="p">,</span>
    <span class="nt">&quot;voltage_1&quot;</span><span class="p">:</span> <span class="mf">3.9</span><span class="p">,</span>
    <span class="nt">&quot;distance_1&quot;</span><span class="p">:</span> <span class="mi">43</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>As printed above, the format would take a total of 73 Bytes (584 Bits) which is
nearly 20 times bigger than using the raw format. Even a slightly optimized
version as shown below would still require 28 Bytes (224 Bits) meaning 7 times
bigger.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;t1&quot;</span><span class="p">:</span><span class="mf">18.6</span><span class="p">,</span><span class="nt">&quot;v1&quot;</span><span class="p">:</span><span class="mf">3.9</span><span class="p">,</span><span class="nt">&quot;d1&quot;</span><span class="p">:</span><span class="mi">43</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="encoding-using-cayennelpp">Encoding using CayenneLPP</h2>
<p>CayenneLPP uses a compromise of both approaches, the data is very compact while
being self descriptive. To archive that common measurement types are available
with a 1 Byte data type descriptor and a 1 Byte data type channel (or ID). Each
data type, be it temperature, GPS or relative humidity is described by a number
between 0 and 255, a official reference implementation is available in the
<a href="https://developers.mydevices.com/cayenne/docs/lora/#lora-cayenne-low-power-payload-reference-implementation-cayenne-lpp-cc-constants-definitions">Cayenne Docs</a>. Since all data types are based on <a href="https://technical.openmobilealliance.org/OMNA/LwM2M/LwM2MRegistry.html#extlabel">IPSO data
types</a> other implementations support additional values, like voltage,
altitude and distance<sup id="fnref:cats-api"><a class="footnote-ref" href="#fn:cats-api">4</a></sup>.</p>
<p>Adding those values on device is done by a creating a <code>CayenneLPP</code> frame and
adding values. More details are available in <a href="node/main.cpp.md"><code>main.cpp</code>
implementation</a>, however below is an simplified example.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">CayenneLPP</span><span class="w"> </span><span class="nf">lpp</span><span class="p">(</span><span class="n">LORAWAN_APP_DATA_MAX_SIZE</span><span class="p">);</span><span class="w">      </span><span class="c1">// create frame</span>
<span class="n">lpp</span><span class="p">.</span><span class="n">addVoltage</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">getBatteryVoltage</span><span class="p">());</span><span class="w">         </span><span class="c1">// add voltage</span>
<span class="n">lpp</span><span class="p">.</span><span class="n">addDistance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">);</span><span class="w">                   </span><span class="c1">// add distance in mm</span>
<span class="n">lpp</span><span class="p">.</span><span class="n">addTemperature</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="p">);</span><span class="w">             </span><span class="c1">// add temperature in Celsius</span>
<span class="n">appDataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpp</span><span class="p">.</span><span class="n">getSize</span><span class="p">();</span><span class="w">                    </span><span class="c1">// calculate size</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">appData</span><span class="p">,</span><span class="w"> </span><span class="n">lpp</span><span class="p">.</span><span class="n">getBuffer</span><span class="p">(),</span><span class="w"> </span><span class="n">appDataSize</span><span class="p">);</span><span class="w">  </span><span class="c1">// copy Bytes to LoRaWAN packet</span>
</code></pre></div>
</td></tr></table>
<p>The same is possible to do via Python using the <code>pycayennelpp</code> package<sup id="fnref2:py"><a class="footnote-ref" href="#fn:py">5</a></sup>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cayennelpp</span> <span class="kn">import</span> <span class="n">LppFrame</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">LppFrame</span><span class="p">()</span>
<span class="n">frame</span><span class="o">.</span><span class="n">add_temperature</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">18.6</span><span class="p">)</span>
<span class="n">frame</span><span class="o">.</span><span class="n">add_distance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">43</span><span class="p">)</span>
<span class="n">frame</span><span class="o">.</span><span class="n">add_voltage</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<p>The result are <strong>14 Bytes</strong> and thereby half the size of using JSON. For
measurements which are not directly supported by the implementations, like
<em>number of satelites</em> for GPS measurements, it is possible to use the commands
<code>addDigitalInput</code> or <code>addDigitalOutput</code> (unsigned  32 Bit Integer) and
<code>addAnalogInput</code> or <code>addAnalogOutput</code> (float with 3 decimals).</p>
<h2 id="decoding-in-backend">Decoding in Backend</h2>
<p>The receiving backend allows to decode incoming data before offering it via
MQTT. This is very useful so different applications listening to the MQTT stream
can directly process the decoded payload rather than implementing that per
client, allowing as well to upgrade the communication used for nodes without
modifying clients.</p>
<p>TheThingsNetwork offers to automatically decode CayenneLPP frames using the
<em>Payload Formatter</em> menu entry.</p>
<p><img alt="" src="../../img/ttn_cayenne.png" /></p>
<p>However, since TheThingsNetwork uses the reference implementation of <em>MyDevices</em>
they don't support decoding some additional data types, like distance. If these
measurements are used it is possible to use a custom JavaScript decoder as
offered by <em>ElectronicCats</em> to be used directly in TheThingsNetwork. The
<a href="https://github.com/ElectronicCats/CayenneLPP/tree/master/decoders"><code>decoder.min.js</code></a> can be pasted into the text field of the <em>Payload
Formatter</em> menu entry:</p>
<blockquote>
<p>The <code>min</code> decoder version is required as TheThingsNetwork limits the total
size of decoding scripts and the formated version exceeds that limit.</p>
</blockquote>
<p><img alt="" src="../../img/ttn_javascript.png" /></p>
<h2 id="used-payload-types">Used payload types</h2>
<p>Within this project the following payload types and IDs are used.</p>
<table>
<thead>
<tr>
<th>JSON value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>analog_in_1</code></td>
<td>rain mm/m</td>
</tr>
<tr>
<td><code>analog_in_2</code></td>
<td>soil moisture</td>
</tr>
<tr>
<td><code>digital_out_1</code></td>
<td>running software version (integer)</td>
</tr>
<tr>
<td><code>temperature_1</code></td>
<td>temperature</td>
</tr>
<tr>
<td><code>voltage_1</code></td>
<td>battery voltage</td>
</tr>
<tr>
<td><code>distance_1</code></td>
<td>distance to sea level</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:mydevices">
<p>https://developers.mydevices.com/cayenne/features/&#160;<a class="footnote-backref" href="#fnref:mydevices" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:llp">
<p>https://developers.mydevices.com/cayenne/docs/lora/#lora-cayenne-low-power-payload&#160;<a class="footnote-backref" href="#fnref:llp" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:cats">
<p>https://github.com/ElectronicCats/CayenneLPP/&#160;<a class="footnote-backref" href="#fnref:cats" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:cats-api">
<p>https://github.com/ElectronicCats/CayenneLPP/blob/master/API.md#methods-add&#160;<a class="footnote-backref" href="#fnref:cats-api" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:py">
<p>https://github.com/smlng/pycayennelpp&#160;<a class="footnote-backref" href="#fnref:py" title="Jump back to footnote 5 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:py" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../hardware/pcb/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Printed Circuit Board" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Printed Circuit Board
            </div>
          </div>
        </a>
      
      
        
        <a href="../datasheets/" class="md-footer__link md-footer__link--next" aria-label="Next: Datasheets" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Datasheets
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Paul Spooren / CC BY 4.0
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.94ec81fe.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.48dfec6c.min.js"></script>
      
    
  </body>
</html>